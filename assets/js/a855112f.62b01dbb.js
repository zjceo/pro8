"use strict";(globalThis.webpackChunkpro_8=globalThis.webpackChunkpro_8||[]).push([[55040],{28453(e,a,s){s.d(a,{R:()=>i,x:()=>c});var n=s(96540);const r={},o=n.createContext(r);function i(e){const a=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function c(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),n.createElement(o.Provider,{value:a},e.children)}},40593(e,a,s){s.r(a),s.d(a,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>i,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"devs/devops/manual-de-actualizacion","title":"Manual de Actualizaci\xf3n","description":"Requisitos previos","source":"@site/docs/devs/devops/manual-de-actualizacion.md","sourceDirName":"devs/devops","slug":"/devs/devops/manual-de-actualizacion","permalink":"/devs/devops/manual-de-actualizacion","draft":false,"unlisted":false,"editUrl":"https://github.com/zjceo/pro8/tree/main/docs/devs/devops/manual-de-actualizacion.md","tags":[],"version":"current","lastUpdatedBy":"zjceo","lastUpdatedAt":1766108651000,"frontMatter":{},"sidebar":"defaultSidebar","previous":{"title":"Gu\xeda para Limpiar Cache de Laravel","permalink":"/devs/devops/limpiar-cache"},"next":{"title":"Migraci\xf3n de Documento Individual","permalink":"/devs/devops/migracion-de-documento-individual"}}');var r=s(74848),o=s(28453);const i={},c="Manual de Actualizaci\xf3n",l={},d=[{value:"Requisitos previos",id:"requisitos-previos",level:2},{value:"Pasos",id:"pasos",level:2},{value:"Caso FPM",id:"caso-fpm",level:2},{value:"MariaDB",id:"mariadb",level:2},{value:"Comandos extras",id:"comandos-extras",level:2},{value:"Backup",id:"backup",level:3},{value:"Restore",id:"restore",level:3},{value:"Posibles errores",id:"posibles-errores",level:2}];function t(e){const a={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.header,{children:(0,r.jsx)(a.h1,{id:"manual-de-actualizaci\xf3n",children:"Manual de Actualizaci\xf3n"})}),"\n",(0,r.jsx)(a.h2,{id:"requisitos-previos",children:"Requisitos previos"}),"\n",(0,r.jsxs)(a.ol,{children:["\n",(0,r.jsx)(a.li,{children:"Tener acceso a su servidor, VPS, m\xe1quina virtual o local v\xeda SSH. En las instalaciones para AWS o Google Cloud, se entrega el usuario, la IP del servidor y la clave SSH (archivo .ppk o .pem)."}),"\n",(0,r.jsx)(a.li,{children:"Tener instalada una versi\xf3n de SSH en su m\xe1quina para conectarse de manera remota. Puede utilizar PuTTY, FileZilla o una consola terminal."}),"\n",(0,r.jsx)(a.li,{children:"Tener los accesos y credenciales de GitLab y de los entornos creados con Docker, usuario MySQL, root, entre otros. Estos son entregados una vez realizada la instalaci\xf3n y pueden encontrarse en los archivos .env y docker-compose.yml."}),"\n",(0,r.jsxs)(a.li,{children:["Conocer el nombre del proyecto. En el ejemplo se ha usado ",(0,r.jsx)(a.code,{children:"multifacturalo"}),". Debe tomar en cuenta el proyecto que se le ha compartido en GitLab."]}),"\n"]}),"\n",(0,r.jsx)(a.h2,{id:"pasos",children:"Pasos"}),"\n",(0,r.jsxs)(a.ol,{children:["\n",(0,r.jsx)(a.li,{children:"Acceder a su instancia v\xeda SSH."}),"\n",(0,r.jsxs)(a.li,{children:["Loguearse como superusuario ejecutando ",(0,r.jsx)(a.code,{children:"sudo su"}),"."]}),"\n",(0,r.jsxs)(a.li,{children:["Ejecutar ",(0,r.jsx)(a.code,{children:"docker ps"})," y verificar que est\xe9n al menos las siguientes l\xedneas que equivalen a los contenedores de cada servicio iniciado por Docker."]}),"\n"]}),"\n",(0,r.jsxs)(a.p,{children:["En la lista deber\xe1 fijarse en los ",(0,r.jsx)(a.strong,{children:"NAMES"})," que contengan ",(0,r.jsx)(a.strong,{children:"fpm"})," y ",(0,r.jsx)(a.strong,{children:"mariadb"})," ya que en ellos deber\xe1 acceder."]}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"multifacturalo_fpm2_1"}),": Equivale al nombre del proyecto donde una vez accedido se encontrar\xe1 justo en la ruta donde se ha alojado el repositorio y podr\xe1 ejecutar comandos ",(0,r.jsx)(a.code,{children:"artisan"}),", ",(0,r.jsx)(a.code,{children:"git"})," o ",(0,r.jsx)(a.code,{children:"composer"}),". Este nombre puede variar un poco, puede llamarse ",(0,r.jsx)(a.code,{children:"multifacturalo_fpm1_1"}),"."]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"multifacturalo_mariadb2_1"}),": Es el contenedor donde podr\xe1 acceder a MySQL y utilizar comandos para ello (desde aqu\xed no se ejecutan comandos PHP, artisan, git, entre otros)."]}),"\n"]}),"\n",(0,r.jsxs)(a.ol,{start:"4",children:["\n",(0,r.jsx)(a.li,{children:"Una vez ubicado el contenedor a acceder, ejecute el siguiente comando:"}),"\n"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"docker exec -ti multifacturalo_fpm1_1 bash\n"})}),"\n",(0,r.jsx)(a.p,{children:"De esta manera se conectar\xe1 al contenedor y observar\xe1 un cambio en el inicio de la terminal."}),"\n",(0,r.jsx)(a.h2,{id:"caso-fpm",children:"Caso FPM"}),"\n",(0,r.jsxs)(a.p,{children:["Si ha accedido a ",(0,r.jsx)(a.strong,{children:"fpm"}),", entonces se debe encontrar en la ruta ",(0,r.jsx)(a.code,{children:"/var/www/html/"})," donde podr\xe1 ejecutar comandos de la siguiente lista (cada comando se ejecuta para situaciones distintas, mayormente no se necesitan ejecutar m\xe1s de dos comandos en una actualizaci\xf3n):"]}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.code,{children:"git pull origin master"})," (usar siempre)"]}),"\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.code,{children:"git log -5"})}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.code,{children:"php artisan migrate"})," (usar siempre)"]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.code,{children:"php artisan tenancy:migrate"})," (usar siempre)"]}),"\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.code,{children:"php artisan storage:link"})}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.code,{children:"php artisan config:cache"})," (usar siempre)"]}),"\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.code,{children:"php artisan config:clear"})}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.code,{children:"php artisan cache:clear"})," (usar siempre)"]}),"\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.code,{children:"composer update"})}),"\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.code,{children:"composer install"})}),"\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.code,{children:"composer dumpautoload"})}),"\n"]}),"\n",(0,r.jsxs)(a.p,{children:["Si ha utilizado ",(0,r.jsx)(a.code,{children:"git pull origin master"}),", debe ingresar las credenciales de GitLab, su correo y contrase\xf1a de acceso (la contrase\xf1a no se muestra en pantalla al ingresarla)."]}),"\n",(0,r.jsxs)(a.p,{children:["Debe hacer uso de los comandos seg\xfan sea el caso. Por ejemplo, posterior a un ",(0,r.jsx)(a.code,{children:"git pull origin master"})," que le muestre cambios en migraciones, deber\xe1 ejecutar ",(0,r.jsx)(a.code,{children:"php artisan migrate"})," y ",(0,r.jsx)(a.code,{children:"php artisan tenancy:migrate"}),". De esta manera actualizar\xe1 los campos de las bases de datos. B\xe1sicamente, cada comando cumple una funci\xf3n espec\xedfica y no todos son usados cada vez que se realiza una actualizaci\xf3n."]}),"\n",(0,r.jsx)(a.h2,{id:"mariadb",children:"MariaDB"}),"\n",(0,r.jsxs)(a.p,{children:["Si ha accedido a ",(0,r.jsx)(a.strong,{children:"mariadb"}),", podr\xe1 hacer uso de comandos MySQL \xfanicamente. Al acceder, deber\xe1 utilizar:"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"mysql -u root -p\n"})}),"\n",(0,r.jsxs)(a.p,{children:["Le solicitar\xe1 la contrase\xf1a, la cual se encuentra en el archivo .env dentro del proyecto. Tambi\xe9n le fue entregada al momento de instalar el proyecto en su servidor. Si ha utilizado los canales de ",(0,r.jsx)(a.strong,{children:"Slack"}),", estos est\xe1n mayormente en las chinchetas del canal."]}),"\n",(0,r.jsx)(a.h2,{id:"comandos-extras",children:"Comandos extras"}),"\n",(0,r.jsx)(a.p,{children:"Para detener y restaurar los contenedores (servicios), dir\xedjase a la ruta de su proyecto y ejecute los siguientes comandos:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"docker-compose down\r\ndocker-compose up -d\n"})}),"\n",(0,r.jsx)(a.p,{children:"Otra manera de detener los contenedores puede ser individualmente con los siguientes comandos:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"docker stop multifacturalo_fpm2_1\r\ndocker start multifacturalo_fpm2_1\r\ndocker restart multifacturalo_fpm2_1\n"})}),"\n",(0,r.jsx)(a.p,{children:"Si desea respaldar o montar un respaldo de una base de datos, puede ejecutar los siguientes comandos:"}),"\n",(0,r.jsx)(a.h3,{id:"backup",children:"Backup"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"docker exec CONTAINER /usr/bin/mysqldump -u root --password=root DATABASE > backup.sql\n"})}),"\n",(0,r.jsx)(a.h3,{id:"restore",children:"Restore"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"cat backup.sql | docker exec -i CONTAINER /usr/bin/mysql -u root --password=root DATABASE\n"})}),"\n",(0,r.jsxs)(a.p,{children:["Donde ",(0,r.jsx)(a.code,{children:"CONTAINER"})," se refiere al nombre del contenedor ",(0,r.jsx)(a.code,{children:"multifacturalo_fpm2_1"}),"."]}),"\n",(0,r.jsx)(a.h2,{id:"posibles-errores",children:"Posibles errores"}),"\n",(0,r.jsxs)(a.p,{children:["Luego de una actualizaci\xf3n donde utilice el comando ",(0,r.jsx)(a.code,{children:"composer install"}),", debe darle permisos a la carpeta en ",(0,r.jsx)(a.code,{children:"vendor"})," del paquete de ",(0,r.jsx)(a.code,{children:"mpdf"}),":"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"chmod -R 777 vendor/mpdf/mpdf/tmp\n"})})]})}function u(e={}){const{wrapper:a}={...(0,o.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}}}]);